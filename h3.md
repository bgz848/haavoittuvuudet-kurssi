# H3
## A).
Latasin ensiksi tehtävä sivulta.
https://terokarvinen.com/application-hacking/#h3-no-strings-attached-tero
Ekstraktoin tehtävän 

Sitten ajoin Strings ohjelman passtr tehtävä ohjelmalla.
![Tehtävän alkuperäisen ohjelman lähdekoodi](https://raw.githubusercontent.com/bgz848/haavoittuvuudet-kurssi/refs/heads/main/h3a1.png)

Salasana löytyi selkotekstinä pienen selailun jälkeen.
![Tehtävän alkuperäisen ohjelman lähdekoodi](https://raw.githubusercontent.com/bgz848/haavoittuvuudet-kurssi/refs/heads/main/h3a2.png)

Ajoin ohjelman ja annoin sille salasanan jonka sain Strings ohjelmalla.
![Tehtävän alkuperäisen ohjelman lähdekoodi](https://raw.githubusercontent.com/bgz848/haavoittuvuudet-kurssi/refs/heads/main/h3a3.png)

## B).
Tehtävänä oli estää salasanaa näkymästä suoraan strings ohjelmaa käyttämällä. 

Alkuperäistä ohjelman lähdekoodi on erittäin yksinkertainen ja uskoin että paras vaihtoehto olisi muokata ohjelmaa mahdollisimman vähä.
![Tehtävän alkuperäisen ohjelman lähdekoodi](https://raw.githubusercontent.com/bgz848/haavoittuvuudet-kurssi/refs/heads/main/h3b4.png)

Päätin käyttää Vigenere salausta, joka sekoittaa lähdetekstin käyttämällä toista tekstiä jota kutsutaan avaimeksi, koska ymmärsin ennalta kuinka se toimi.
Avain sana toistetaan kunnes pituus on sama kuin salattava teksti. Sitten avaiment kirjaimen numeroa (A on 0, B on 1 yms) käytetään määräämään kuinka monta kirjainta eteenpäin salattavan tekstin sisällön kirjaimia siirretään. 

Decryptaus koodini perustuu [Just4Programmers 2017](https://just4programmers.wordpress.com/2017/08/18/vigenere-cipher-in-c-and-c/) artikkelissa olevaan logiikkaan.

      //decryption
      for(i = 0; i < msgLen; ++i)
        decryptedMsg[i] = (((encryptedMsg[i] - newKey[i]) + 26) % 26) + 'A';

Käytin [sivun](https://www.cs.du.edu/~snarayan/crypt/vigenere.html) Vigenere enkoodausta muuttaakseni salasanan 

      sala-hakkeri-321
sen "avain" avainsanalla encryptatuksi versioksi

      svli-uafkmei-321
Loin aluksi ohjelman, joka vain decryptasi salasanan. Koodiin jouduin tekemään muutoksia kuten - merkkien ohittaminen ja isojen kirjaimien sijaan pienien käyttö. 
![Lähdekoodia ohjelmalle joka decryptaa inputin](https://raw.githubusercontent.com/bgz848/haavoittuvuudet-kurssi/refs/heads/main/h3b1.png)

Kuvassa näkyy lopputulos. 
![Lopullisen ohjelman lähdekoodi](https://raw.githubusercontent.com/bgz848/haavoittuvuudet-kurssi/refs/heads/main/h3b3.png)

Kun ohjelmaa tarkistelee Strings ohjelmalla siinä ei enää suoraan näy salasanaa. Avain itse ei näy myöskään suoraan, mutta tämä ei ollut tarkoituksellista.
![Strings ohjelman ajaminen ilman salasanan näkemymistä](https://raw.githubusercontent.com/bgz848/haavoittuvuudet-kurssi/refs/heads/main/h3b2.png)

## C).
Avasin packd tiedoston heti Stringsillä, jonka avulla löytyi teksti pätkä.
![Strings ohjelman näkymä packd ohjelmasta](https://raw.githubusercontent.com/bgz848/haavoittuvuudet-kurssi/refs/heads/main/h3c1.png)

      $Info: This file is packed with the UPX executable packer http://upx.sf.net $

http://upx.sf.net sivu siirsi suoraan sivulle https://upx.github.io/ joka esittelee ohjelman. Sivua lukiessa näin, että UPX tukee virallisesti tiedostojen purkamista.

      safe: you can list, test and unpack your executables. Also, a checksum of both the compressed and uncompressed file is maintained internally.
Siirryin lataus sivulle https://github.com/upx/upx/releases/tag/v5.1.0 ja latasin koneelleni sopivan version ohjelmasta. upx-5.1.0-amd64_linux.tar.xz 


Avasin ja pyöritin upx ohjelman ilman mitään parametrejä toivoen, että se outputtaisi asetukset jotka on saatavilla. 

      ./upx
![UPX ohjelman ajamin ilman parameetteriä](https://raw.githubusercontent.com/bgz848/haavoittuvuudet-kurssi/refs/heads/main/h3c2.png)

Näin flagin -d decompress ja tiesin olevani oikealla tiellä. Ohjelman syntaksi on onneksi erittäin simppeliä ja siirrettyäni packd tiedoston ohjelman kansioon pystyin vain ajamaan komennon.

    ./upx -d packd -o packd-unpacked
![Packd ohjelman decompressointi UPX ohjelmalla](https://raw.githubusercontent.com/bgz848/haavoittuvuudet-kurssi/refs/heads/main/h3c3.png)
Tämän jälkeen ajoin decompressoidun unpackd ohjelman strings ohjelman läpi. Odotukseni oli, että ohjelma vaatisi vielä yhden askeleen tämän jälkeen.

    strings packd-unpacked
![Decompressoidun packd ohjelman ajaminen strings ohjelmalla](https://raw.githubusercontent.com/bgz848/haavoittuvuudet-kurssi/refs/heads/main/h3c4.png)
Ohjelma ei tarvinnutkaan lisä työtä sillä näytti, että lippu oli täysi. Itse salasana näytti epäilyttävältä joten varmistin että se toimi ohjelmassa.

    ./packd
    piilos-AnAnAs
![Packd ohjelman ajaminen oikealla salasanalla](https://raw.githubusercontent.com/bgz848/haavoittuvuudet-kurssi/refs/heads/main/h3c5.png)

## Lähteet
https://www.cs.du.edu/~snarayan/crypt/vigenere.html

https://just4programmers.wordpress.com/2017/08/18/vigenere-cipher-in-c-and-c/

https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher

https://terokarvinen.com/application-hacking/#h3-no-strings-attached-tero

https://upx.github.io/
